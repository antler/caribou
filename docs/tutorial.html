<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <script type="text/javascript" src="js/shCore.js"></script>
    <script type="text/javascript" src="js/shAutoloader.js"></script>
    <script type="text/javascript" src="js/shBrushClojure.js"></script>
    <script type="text/javascript" src="js/shBrushBash.js"></script>
    <script type="text/javascript" src="js/shBrushXml.js"></script>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/shCore.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/shThemeRDark.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/shClojureExtra.css" media="screen" />

    <title>Caribou Documentation</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Caribou Documentation</h1>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
<h1>Tutorial</h1><p>As part of this tutorial, you'll create a sample application.  You can call it whatever you like but for the purposes of this tutorial, we will call it <em>pictograph</em>.</p><p><h2>1. Create your app</h2></p><p>To create your app, you only need to run one command:</p><pre>
lein caribou create pictograph
</pre><p>This will create your application, with a working configuration right out of the box, including its own database (which you can change at any time).</p><p>The project structure initially looks like this:</p><pre>
&gt; tree pictograph
pictograph
├── api
│   ├── README.md
│   ├── project.clj
│   └── resources
│       └── public
│           └── cors
│               └── index.html
├── app
│   └── assets
├── caribou.keystore
├── project.clj
├── resources
│   ├── config
│   │   ├── boot.clj
│   │   ├── development.clj
│   │   ├── production.clj
│   │   ├── staging.clj
│   │   └── test.clj
│   └── migrations
├── site
│   ├── README.md
│   ├── project.clj
│   ├── resources
│   │   ├── public
│   │   │   └── ... twitter bootstrap files ...
│   │   └── templates
│   │       └── home.html
│   └── src
│       └── pictograph
│           ├── controllers
│           │   └── home.clj
│           └── core.clj
├── src
│   └── pictograph
│       ├── hooks
│       │   └── model.clj
│       └── migrations
│           ├── default.clj
│           └── order.clj
└── target
    ├── classes
    └── stale
        └── dependencies

26 directories, 40 files
</pre><h2>2. Run your app</h2><p>Now that your application exists, you can start it:</p><pre>
cd pictograph
lein caribou start
</pre><p>Your Caribou application is now running on port 33333.</p><h2>3. Login into the Admin interface</h2><p>Point your browser at [http://localhost:33333] and follow the link to the admin interface.  Log in with username <i>caribou</i> and password <i>caribou</i>.  You'll be presented with a list of models:</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;9&#95;34&#95;AM.png" alt="Models page" title="Models" /></p><h2>4. Create A Model Called "Presentation"</h2><p>Click the "New Model" button to start creating your own custom content.  We'll start by creating a model called <em>Presentation</em>.</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;9&#95;34&#95;AM-2.png" alt="Models page" /> <img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;9&#95;36&#95;AM.png" alt="Models page" /></p><p>After you've created your model, you'll be shown a page of all of the fields in your new model.   Initially, the fields will only be the default set of fields that Caribou uses to maintain your model, but you can add new fields. </p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;9&#95;37&#95;AM.png" alt="Models page" /> <img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;9&#95;37&#95;AM" alt="Models page" title=2.png /></p><p>You will start by adding three new fields:</p><ul><li>A "string" called "Title" (leave "searchable" checked)</li><li>A "string" called "Author" (leave "searchable" checked)</li><li>A "date/time" called "Presentation Date" (uncheck the "searchable" box)</li></ul><p>After you've added these three fields, drag the "Title" field to thetop and click "Save" to update the order that the fields appear in your model.</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;9&#95;41&#95;AM.png" alt="Models page" /></p><p>Next you'll create a second model, and then we'll connect them.</p><p><h2>5. Create A Model Called "Slide"</h2></p><p>Return to the <em>Models</em> page by clicking the <em>Models</em> link in the breadcrumbs.</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;9&#95;43&#95;AM.png" alt="Models page" /></p><p>Just like you did with <em>Presentation</em>, create a new model called <em>Slide</em>, and add three fields (these are slightly different):</p><ul><li>A "string" called "Title"</li><li>A "string" called "Caption"</li><li>An "asset" called "Image"</li></ul><p>and once again, drag the title to the top and click "Save".</p><h2>6. Connecting "Presentation" to "Slide"</h2><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;9&#95;47&#95;AM.png" alt="Models page" /></p><p>Go back to the Models page, and click "Tweak fields" for the <em>Presentation</em> Model. You're going to add another fields that will represent a collection of slides that belong to a presentation.  Click <em>"+ attribute"</em> to add another attribute, but this time set the type "Collection of other model things".  Enter <em>Slides</em> for the name, uncheck the "searchable" checkbox, and choose <em>Slide</em> as the Target.</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;9&#95;49&#95;AM.png" alt="Models page" title="Models" /></p><p>Your presentations all now have a collection of slides, and each slide has an associated presentation!</p><h2>7. Create Some Content!</h2><p>From the <em>Presentation</em> dropdown at the top, choose "Create New" to make a new presentation, then click "Save then continue editing".</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;12&#95;09&#95;PM-3.png" alt="Models page" title="Models page" /></p><p>Once you've saved it, you can now add slides to the <i>slides</i> collection.</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;12&#95;17&#95;PM.png" alt="Models page" /></p><p>so click on <i>Edit</i> and you'll move to a screen to add a slide:</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;12&#95;20&#95;PM.png" alt="Add a slide" /></p><p>As you can see, there are no <em>Slides</em> associated with this <em>Presentation</em> yet, so you can click <em>"+ new"</em> to create a new <em>Slide</em> within this <em>Presentation</em>:</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;12&#95;22&#95;PM.png" alt="New slide" /></p><p>Be sure to upload an image too by clicking on <em>"Choose/Edit"</em> and selecting an image.</p><p>Go ahead and create a couple more slides, so you end up with something like this:</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;12&#95;34&#95;PM.png" alt="slides" /></p><p><h2>8. Make some pages!</h2></p><p>(<strong>Note:</strong> at present you need to create pages through the generic admin UI.  This will change soon when we provide a Page-editor)</p><p>Now we're going to create user-facing pages to show our presentations.</p><p>Go to the models page, and scroll to <em>System Models</em> at the bottom. Choose <em>"View fields"</em> from <em>Page</em>, then "Create a Page".   Fill in the fields like this to create a page that will show a <em>Presentation</em>:</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;1&#95;58&#95;PM.png" alt="Presentation page" /></p><p>and then create a page to display a slide, again, paying attention to the fields:</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;1&#95;59&#95;PM.png" alt="Slide page" /></p><p>(<strong>Note:</strong> We set the parent id of the <em>Slide</em> page to the ID of the newly-created <em>Presentations</em> page - this step will happen automatically in the future).</p><p><h2>9. Check your pages in the browser!</h2></p><p>Navigate to your new <em>Presentation</em> page, at [http://localhost:33333/presentation/Mountains]</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;4&#95;00&#95;PM-2.png" alt="Presentation page" /></p><p>Oh no!  Your controller action doesn't exist yet.  We need to build it! Open the file <i>site/src/pictograph/controllers/home.clj</i> and add the following code:</p><pre class="brush: clj">
&#40;defn presentation
  &#91;request&#93;
  &#40;let &#91;title &#40;-&gt; request :params :title&#41;
        presentation &#40;model/pick
                      :presentation
                      {:where {:title title}
                       :include {:slides {}}}&#41;&#93;
    &#40;render &#40;assoc request
              :presentation presentation&#41;&#41;&#41;&#41;
</pre><p>This is what a simple action looks like.  It grabs the title of presentation from the URL, and then retrieves that presentation.  Finally, it renders the page, adding in the newly-fetched presentation, making it available to the template(s).</p><p>Now, if you refresh your browser, you'll see this:</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;4&#95;07&#95;PM.png" alt="Presentation page" /></p><p>Oh no! Now there's no template.  But the application is telling you what's missing, so you know exactly what to do.   Let's create a new template for the page in <i>site/resources/templates/presentation.html</i>.</p><pre class="brush: html">
{{&lt; templates/layout.html}}
{{%body}}
&lt;h1&gt;{{presentation.title}}&lt;/h1&gt;
{{#presentation.slides}}
&lt;a href=&quot;{{route-for :slide {:title presentation.title :slide title} }}&quot;&gt;&lt;img src=&quot;{{resize image {:height 200} }}&quot; /&gt;&lt;/a&gt;
{{/presentation.slides}}
{{/body}}
</pre><p>Refresh your browser, and presto!  Here are your presentation's slides.  <br /></p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;4&#95;44&#95;PM.png" alt="Presentation page" title="Presentation page" /></p><p>Each slide is clickable (thanks to the <i>route-for</i> in the above HTML snippet) and the images are conveniently resized (and cached!) thanks to the <i>resize</i>.   More on those later.</p><p>If you click one of the images, you'll see something familiar:</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;5&#95;00&#95;PM.png" alt="Slide page" title="Slide page" /></p><p>and you know that this means you need to write the action for this page:</p><pre class="brush: clj">
&#40;defn slide
  &#91;request&#93;
  &#40;let &#91;slide-title &#40;-&gt; request :params :slide&#41;
        slide     &#40;model/pick
                   :slide
                   {:where {:title slide-title}
                    :include {:presentation {}}}&#41;
        following &#40;model/following
                   :slide slide
                   :presentation&#95;position
                   {:where &#40;select-keys slide &#91;:presentation&#95;id&#93;&#41;}&#41;
        previous  &#40;model/previous
                   :slide slide
                   :presentation&#95;position
                   {:where &#40;select-keys slide &#91;:presentation&#95;id&#93;&#41;}&#41;&#93;
    &#40;render &#40;assoc request
              :slide slide
              :following following
              :previous previous&#41;&#41;&#41;&#41;
</pre><p>This action looks a bit more complicated but really it's not.  It fetches the slide that's mentioned in the URL, then fetches the following and previous slides in the presentation.  Then it makes all three available to the template.</p><p>You'll also need to create the template in <i>site/resources/templates/slide.html</i>:</p><pre class="brush: html">
{{&lt; templates/layout.html}}
{{%body}}
&lt;h1&gt;{{slide.title}}&lt;/h1&gt;
&lt;img src=&quot;{{resize slide.image {:height 500} }}&quot; /&gt;
&lt;h2&gt;{{slide.caption}}&lt;/h2&gt;
{{#previous}}&lt;p&gt;&lt;&lt;&lt; &lt;a href=&quot;{{route-for :slide {:title slide.presentation.title :slide previous.title} }}&quot;&gt;{{previous.title}}&lt;/a&gt;&lt;/p&gt;{{/previous}}
{{#following}}&lt;p&gt;&lt;a href=&quot;{{route-for :slide {:title slide.presentation.title :slide following.title} }}&quot;&gt;{{following.title}}&lt;/a&gt; &gt;&gt;&gt;&lt;/p&gt;{{/following}}
{{/body}}
</pre><p>and now here's your slide page:</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;5&#95;09&#95;PM.png" alt="Slide page" title="Slide page" /></p><p>and you can click the links at the bottom to go to the next and previous slides.</p><h2>10. Bonus Feature!</h2><p>Go into the admin, and edit your presentation under "Presentations" -> "See all" -> "edit". Click <i>"Edit"</i> in the <em>Slides</em> field, taking you to a view of the slides association with your <em>Presentation</em>.  Drag them into a different order, and click <em>Save</em>.</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;5&#95;13&#95;PM.png" alt="Presentation editor page" title="Presentation editor page" /></p><p>Now refresh your "Presentation" page, and the order of the slides will have changed!</p><p><img src="images/tutorial/Screenshot&#95;3&#95;21&#95;13&#95;5&#95;15&#95;PM.png" alt="Presentation with reordered slides" title="Presentation with reordered slides" /></p><p></p>
      </section>
    </div>

  </body>
</html>

<script type="text/javascript">
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.autoloader(
    'clj clojure js/shBrushClojure.js',
    'xml html js/shBrushXml.js',
    'sh bash js/shBrushBash.js'
  );
  SyntaxHighlighter.all()
</script>
