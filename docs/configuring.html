<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>let-caribou-in - Powered By Caribou</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Source Sans Pro:300,400,700">
    <link href="//let-caribou.in/css/let-caribou-in.css" type="text/css" rel="stylesheet">
    <link href="/caribou/docs/stylesheets/styles.css" type="text/css" rel="stylesheet">
    <link href="/caribou/docs/highlight/styles/rainbow.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="/caribou/docs/highlight/highlight.pack.js"></script>
    <link rel="shortcut icon" href="favicon.ico">
  </head>

  <body>
    <header>
      <img src="//let-caribou.in/img/caribou-logo.png" width="158" height="139">
      <h2><a href="outline.html">Documentation</a></h2>
    </header>
    <div class="container">
      <div class="grid-block">
        <div class="col-6">
<h1>Configuring Caribou</h1><h2>How Configuration Works in Caribou</h2><p>Caribou avoids holding any global state and elects rather to store state particular to the application in a configuration map that is owned by the user. This has a number of advantages, the first being that no code is tied to a particular configuration.  Configurations can be swapped in and out and Caribou will pick up and run with that configuration as if it had been using it the whole time.</p><p>That given, there are a fair number of options and state that Caribou keeps track of and requires to run, so not just any map will work.  In the <code>caribou.config</code> and <code>caribou.app.config</code> namespace there are a number of functions which facilitate the construction, modification and reading of these configuration maps.</p><p>Once you have a configuration map, you can call any Caribou methods inside of a <code>caribou.core/with-caribou</code> block.</p><pre class="brush: clj">
&#40;let &#91;config &#40;pull-config-map-from-somewhere&#41;&#93;
  &#40;caribou.core/with-caribou config
    &#40;... &#41;&#41;  ;; block of code that assumes a caribou config
</pre><p>As we progress we will illuminate a number of Caribou calls that work in this manner.</p><p>Also, in order to access a value that lives inside a Caribou configuration, use <code>caribou.config/draw</code>:</p><pre class="brush: clj">
&#40;caribou.config/draw :models :model :id&#41; ---&gt; The id of the Model model.
</pre><h2>Initializing a Caribou Configuration</h2><p>In general, we will refer to namespaces inside a Caribou project as <code>{project}.foo</code>, since we don't know what you named your project.  So if you named your project "taiga" and we are talking about the <code>{project}.core</code> namespace, that means <code>taiga.core</code>.</p><p>Caribou configuration is done by passing in a configuration map to the <code>caribou.core/init</code> call in the main <code>{project}.boot</code> namespace.  By convention, this map is obtained as a result of calling the <code>caribou.config/config-from-environment</code> method on a default configuration map obtained from <code>caribou.app.config/default-config</code>.</p><pre class="brush: clj">
&#40;let &#91;default &#40;caribou.app.config/default-config&#41;
      local &#40;config/merge-config default local-config&#41;
      config &#40;caribou.config/config-from-environment local&#41;&#93;
  &#40;caribou.core/init config&#41;&#41;
</pre><p><code>caribou.core/init</code> sets up all the state that Caribou needs to run and stores it in the config object passed into it.  Once a config map has been through <code>caribou.core/init</code> it is ready to be used for any Caribou related operation that needs to be performed.</p><p><code>caribou.config/config-from-environment</code> just reads the result of whatever file in <code>resources/config/{environment}.clj</code> matches the current environment setting and merges that map into the default map you provide.  By default the environment is "development", but it can be set as a java option (which can be done in a number of ways).  One of the easiest is to set it in your env like so:</p><pre class="brush: bash">
% export &#95;JAVA&#95;OPTIONS=-Denvironment=production
</pre><p>This is a standard method for setting JVM options from the command line.  (For other methods check the java documentation).</p><p>There is also a <code>local-config</code> map that is defined in <code>boot.clj</code>.  It contains the defaults for every config option that is possible in Caribou, and will be applied to all environments before the config for that environment.  This provides a way to set up sane defaults but still be able to modulate the settings on an environment by environment basis.</p><p>Even though this is the default method for Caribou configuration, you can configure Caribou in any way that gets a configuration map with the right options into <code>caribou.core/init</code> in <code>{project}.boot</code>.  Your <code>{project}.core</code> will call <code>{project}.boot/boot</code> to obtain this map when setting up the initial handler.</p><h2>Configuration Options</h2><p>Caribou is highly configurable in a number of ways.  Caribou configuration is meant to work out of the box, while still allowing for any changes that might be desired along the way.</p><h3>Default Configuration</h3><p>There are a variety of options for configuring a Caribou site.  Most of these you will not need immediately, but they are documented here for when they do become necessary.</p><p>Here is a map of all default configuration options:</p><pre class="brush: clj">
  {:app {:use-database true
         :public-dir &quot;public&quot;
         :default-locale &quot;global&quot;
         :localize-routes &quot;&quot;}
   :assets {:dir &quot;app/&quot;
            :prefix nil
            :root &quot;&quot;}
   :aws {:bucket nil
         :credentials nil}
   :cljs {:root &quot;resources/cljs&quot;
          :reload false
          :options {:output-to &quot;resources/public/js/app/taiga.js&quot;
                    :output-dir &quot;resources/public/js/app/out&quot;
                    :pretty-print true}}
   :controller {:namespace &quot;taiga.controllers&quot;
                :reload true}
   :database {:classname    &quot;org.postgresql.Driver&quot;
              :subprotocol  &quot;postgresql&quot;
              :ssl          true
              :sslfactory   &quot;org.postgresql.ssl.NonValidatingFactory&quot;}
   :error {:show-stacktrace false
           :catch-exceptions true}
   :field {:namespace &quot;taiga.fields&quot;
           :slug-transform &#91;&#91;#&quot;&#91;'\&quot;&#93;+&quot; &quot;&quot;&#93;
                            &#91;#&quot;&#91;&#95; \\/?%:#&#94;\&#91;\&#93;&lt;&gt;@!|$&amp;&#42;+;,.&#40;&#41;&#93;+&quot; &quot;-&quot;&#93;
                            &#91;#&quot;&#94;-+|-+$&quot; &quot;&quot;&#93;&#93;}
   :hooks {:namespace &quot;taiga.hooks&quot;}
   :index {:path &quot;caribou-index&quot;
           :default-limit 1000}
   :logging {:loggers &#91;{:type :stdout :level :debug}&#93;}
   :nrepl {:port nil}
   :query {:enable-query-cache  false
           :query-defaults {}}
   :template {:cache-strategy :never}}
</pre><p>As you can see, there is a whole rainbow of options to choose from.  Let's take them one by one.</p><h3>app</h3><p>Here is where we hold the most general configuration level options.</p><ul><li><strong>use-database</strong>Determines whether or not a database is in use.  Usually left at <code>true</code>.</li><li><strong>public-dir</strong>The directory that holds all of the static resources a site contains.  Anything placed in the public directory is available at the url representing its file path without having to go through the router.</li><li><strong>default-locale</strong>The name given to the default locale.  If you are not using localization you can safely ignore this option.  If you are using localization, this is the locale that is given to request maps if no other locale is specified.</li><li><strong>localize-routes</strong>This is a string holding a prefix to all routes that you can set to acquire the current locale.  Usually set to something sensible like ":locale" so that the locale string shows up in your requests under (-> request :params :locale), but you can set it to whatever you want.</li></ul><h3>assets</h3><p>Anything having to do with uploaded files is configured in this map.  The  available keys in the assets map are:</p><ul><li><strong>dir</strong>This specifies where local files on disk will be stored after upload.  "app/" by default, could be anywhere on the filesystem.</li><li><strong>prefix</strong>When using s3 for storing assets, this defines the prefix inside the bucket that will be appended to the beginning of any asset path.  This provides a means to have assets from many sites stored in a single bucket (if desired).</li><li><strong>root</strong>The asset root can be used in templates to prefix a given asset with a different host.  This way different environments can have assets that originate from different hosts, like one set of assets for staging and one set for production for example.</li></ul><h3>aws</h3><p>Information about how to connect to amazon is stored here.  Because the  configuration can be different for different environments, you could have one  amazon bucket or account for one environment, and a different account or bucket  for another environment.</p><ul><li><strong>bucket</strong>The name of the s3 bucket that assets will be stored in.</li><li><strong>credentials</strong>A map containing your AWS credentials of the form </li></ul><pre class="brush: clj">
{:access-key &quot;YOUR-ACCESS-KEY&quot; 
 :secret-key &quot;YOUR-SECRET-KEY&quot;}
</pre><h3>cljs</h3><p>This is where you can trigger clojurescript to build automatically on page load.</p><ul><li><strong>:reload</strong> Set this to true to see the modified clojurescript files in :root compiled tojavascript.  To require them uncomment the bottom line of the default resources/templates/home.html template which requires the compiled output. </li><li><strong>:root</strong> A map of the various options that get passed to the clojurescript compiler.</li></ul><h3>controller</h3><p>The various options for configuring controllers.</p><ul><li><strong>namespace</strong>The namespace prefix where all of the controllers in your site live.  Defaults to <code>{project}.controllers</code>, which means that any controller namespace you want to reference must start with <code>{project}.controllers.{controller}</code>.  Actions are functions inside your controller namespace, so the <code>index</code> action inside your <code>home</code> controller in the <code>taiga</code> project would be found at <code>taiga.controllers.home/index</code>.</li><li><strong>reload</strong>Defaults to true.  This reloads every action on every request, which is helpful in development when you are modifying them all the time, but you probably want to turn it off in production unless you are modifying your controllers at runtime (which is not suggested for production!)</li></ul><h3>database</h3><p>Any and all information for connecting to a database go in this map.  Usually  the main feature of each environment's config file, it holds a variety of  options, some of which are relevant only to certain databases:</p><ul><li><strong>classname</strong> -- <em>required</em>The Java class representing the driver for the database.  You can't really connect to the db unless there is a class that handles the connection, which there is for every database we have encountered.</li><li><strong>subprotocol</strong> -- <em>required</em>This string represents the subprotocol that is used to connect to the database through the driver.  Every driver has some specific options (usually only one).</li></ul><p>Current possible values: postgresql, mysql, h2</p><ul><li><strong>host</strong> -- <em>required</em>What host does your database live on?  For local database development this will most likely be <code>localhost</code>, but in many situations this is a remote server.</li><li><strong>database</strong> -- <em>required</em>The actual name of your database.</li><li><strong>user</strong> -- <em>required</em>The user that is being used to access the database.</li><li><strong>password</strong> -- <em>required</em>The password that belongs to the given user.</li><li><strong>protocol</strong>This is a string representing the mode the database is connected to with, if applicable.  For instance, H2 can use file access, tcp access or a variety of others.  Ignore if this does not apply.</li><li><strong>path</strong>For accessing file based databases, this represents the location of your database on disk.  Again, only necessary for file based databases.</li></ul><h4>Some example database configurations</h4><p>Here are a couple of examples of database configurations to get you started:</p><ul><li>Postgresql</li></ul><pre class="brush: clj">
{:database
  {:classname &quot;org.postgresql.Driver&quot;
   :subprotocol &quot;postgresql&quot;
   :host &quot;127.0.0.1&quot;
   :database &quot;caribou&#95;test&quot;
   :user &quot;caribou&quot;
   :password &quot;TUNDRA&quot;}}
</pre><ul><li>Mysql</li></ul><pre class="brush: clj">
{:database
  {:classname &quot;com.mysql.jdbc.Driver&quot;
   :subprotocol &quot;mysql&quot;
   :host &quot;localhost&quot;
   :database &quot;caribou&#95;test&quot;
   :user &quot;caribou&quot;
   :password &quot;TUNDRA&quot;}}
</pre><ul><li>H2</li></ul><p>H2 requires a couple more fields to identify that you are using a file based database and to specify the path.  (notice <code>:protocol</code> and <code>:path</code> are both  present, but not <code>:host</code>)</p><pre class="brush: clj">
{:database
  {:classname &quot;org.h2.Driver&quot;
   :subprotocol &quot;h2&quot;
   :protocol &quot;file&quot;
   :path &quot;./&quot;
   :database &quot;caribou&#95;development&quot;
   :user &quot;h2&quot;
   :password &quot;&quot;}}
</pre><h3>error</h3><p>When errors occur, these options governs how they are handled.</p><ul><li><strong>show-stacktrace</strong>Set this option to true if you want the stacktrace of any exception to appear in the browser.  Not desirable for production when it is better practice to render a custom 500 page, but in development this can be handy (especially if you conjure a lot of stacktraces!)  Otherwise, the stacktrace is rendered out to the logs and a 500 template is rendered in the browser.  Defaults to false.</li><li><strong>catch-exceptions</strong>Usually set to true, this will determine whether exceptions triggered by your application are caught at the outermost handler or are allowed to percolate up to the top level.</li></ul><h3>field</h3><ul><li><strong>namespace</strong>A namespace to hold any custom user-defined Field types.  Any records you define that implement the Field protocol that live in this namespace will be added as types that can be created like any other built in Field type.</li><li><strong>slug-transform</strong>Whenever a piece of content of a Model with a Field of type "slug" is saved, the value for that Field is generated from a linked text Field according to the transformation encoded in this configuration property.  By default this transformation removes quotes and turns special characters and spaces into a dash (-).  Want underscores instead?  Override this config option.</li></ul><h3>hooks</h3><p>Hooks are run at specific point during every piece of content's lifecycle.  The  various hook points are:</p><ul><li><strong>During create these hooks are called in order:</strong></li></ul><pre class="brush: clj">
:before-save
:before-create
:after-create
:after-save
</pre><ul><li><strong>During an update, these hooks are called in order:</strong></li></ul><pre class="brush: clj">
:before-save
:before-update
:after-update
:after-save
</pre><ul><li><strong>When a piece of content is destroyed, these hooks are run:</strong></li></ul><pre class="brush: clj">
:before-destroy
:after-destroy
</pre><ul><li><strong>namespace</strong>The namespace where the various hooks into the Model lifecycle go.  Every hook namespace has a name of the form {hooks-namespace}.{model-name}, and hooks are added in a function called {hooks-namespace}.{model-name}/add-hooks.</li></ul><h3>index</h3><p>The index options control how content is indexed in the built in Lucene search  engine.  This is used in the Admin but you can also use it in your own site.  http://lucene.apache.org/</p><p>Caribou uses the clucy library to abstract over the raw Java Lucene interface: https://github.com/weavejester/clucy</p><ul><li><strong>path</strong>The directory that will hold the index files.  Defaults to "caribou-index". </li><li><strong>default-limit</strong>The maximum number of documents a search will return.  Defaults to 1000. </li></ul><h3>logging</h3><p>Logging contains a list of logger specifications under the :loggers key.  These  specifications are a map containing two keys: <code>:type</code> and <code>:level</code>.  <code>:type</code>  indicates what endpoint the logger will output to (the default logger writes to  :stdout), and <code>:level</code> indicates what level of Caribou events to pay attention  to.</p><p>The different types currently supported are <code>:stdout</code>, <code>:file</code> and <code>:remote</code>.  <code>:stdout</code> simply outputs to stdout, and is the default logger type.  If <code>:file</code>  is chosen, you must also add a <code>:file</code> key to the map pointing at the file to  log to.  If the logger type is <code>:remote</code> then you must also include a <code>:host</code>  key which indicates what remote host to log to.  In the case of a remote host,  it uses UDP to send packets to the host, so the host must be running syslog and  must be configured to allow access from the server sending the packets.</p><p>The levels in order from most critical to least critical are:</p><pre class="brush: clj">
:emergency 0
:alert 1
:critical 2
:error 3
:warning 4
:warn 4
:notice 5
:informational 6
:info 6
:debug 7
:trace 7
</pre><p>If you set a logger to watch at <code>:warn</code> level for instance, it will ignore any  event below <code>:warn</code>, but output all messages from <code>:warn</code> level up to  <code>:emergency</code>.  <code>:emergency</code> level events are always output.</p><h3>nrepl</h3><p>Nrepl provides a repl running inside the Caribou process that can be connected  to from the command line or from inside an editor with  <a href='https://github.com/clojure/tools.nrepl'>nrepl</a> support.  This is a great way to  interact with a running Caribou process and inspect or alter state using a given  configuration.</p><p>If a <code>:port</code> is provided, then an nrepl server will be booted at that port when  Caribou is initialized.  In that case, a reference to the running server will be  stored in the atom under <code>:server</code>.  If no <code>:port</code> option is present, nrepl will not  be booted.</p><h3>query</h3><p>The <code>query</code> option is the domain of the query cache.  Turned off by default, the query cache will cache the results of every query map that <code>caribou.model/gather</code> sees.  There are a variety of entries in this map that play different roles in the inner workings of the query cache.</p><ul><li><strong>enable-query-cache</strong>To turn on the query-cache, simply set this option to <code>true</code> in your config. Not necessary for development, but a good thing to do in production if you know that your content is not necessarily changing often.  Even if it does change, the cache will be invalidated on any update to that model, so your site will remain current.</li><li><strong>query-defaults</strong>This map will be added automatically to any query issues through a <code>caribou.model/gather</code>.  Want to restrict your content to only those "enabled"? This is the place to do it.</li></ul><h3>template</h3><p>The various options pertaining to the built-in template rendering live here.</p><ul><li><strong>cache-strategy</strong>This option governs the caching strategy used by the template engine.  The possible values are currently <code>:never</code> or <code>:always</code>.</li></ul>        </div>
      </div>
    </div>
    <footer>
        <a href="http://caribou.github.io/caribou/docs/outline.html" target="_blank"><img src="//let-caribou.in/img/teepee_golden.svg"></a>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
      $('pre').each(function(i, e) {
          var $e = $(e);
          if ($e.hasClass("clj") || $(e).hasClass("bash") || $e.hasClass("javascript") ||
              $e.hasClass("html") || $(e).hasClass("handlebars") || $(e).hasClass("txt")) {
              $e.html("<code>" + $e.html() + "</code>");
          }
          hljs.highlightBlock(e)
      });
    });
    </script>
    <!-- <script type="text/javascript" src="/js/let-caribou-in.js"></script> -->
    <!-- script type="text/javascript" src="/js/app/out/goog/base.js"></script -->
    <!-- script type="text/javascript" src="/js/app/let-caribou-in.js"></script -->
    <!-- script type="text/javascript">goog.require('let-caribou-in');</script -->
  </body>
</html>
